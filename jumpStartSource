#!/bin/bash

# assumes that the environment variables MYSQL_DB, MYSQL_USER are set
# add to .bash_profile
# export MYSQL_DB=<DB_NAME>
# export MYSQL_USER=<DB_USER>

# check if running in a directory with files
# note: this test is not complete (eg, empty directories can be present)
if [ -z "`find . -type f`" ]
then
	echo "[INFO] Running the script for seemingly empty current directory"
else
	echo "[ERROR] It seems there are files in the current directory. Can't run the script for the fear of overwriting stuff. Do yourself."
	echo "[INFO] You shouldn't be running the script by copying into current directory."
	exit 0
fi

# create the required structure
echo -n "[INFO] Creating directories ... "

# db
mkdir -p db-scripts

# glue
mkdir -p config

# web frontend
mkdir -p css
mkdir -p js

echo "done!"

# add scripts
scriptName="db-scripts/create.sql"
if [ ! -f "$scriptName" ]
then
	echo -n "[INFO] Populating scripts ... "
	touch "$scriptName"
	echo "-- to run the script, use mysql source command" >> "$scriptName"
	echo "-- mysql --database $MYSQL_DB --user $MYSQL_USER --password" >> "$scriptName"
	echo "-- mysql> source \""`pwd`"/$scriptName\"" >> $scriptName
	echo "done!"
fi

configName="config/mysql.php"
if [ ! -f "$configName" ]
then
	echo -n "[INFO] Adding config files ... "
	touch "$configName"
	echo "<?php" >> "$configName"
	echo "define('MYSQL_DB', '$MYSQL_DB');" >> "$configName"	
	echo "define('MYSQL_USER', '$MYSQL_USER');" >> "$configName"	
	echo "define('MYSQL_PASSWORD', '***SET_YOURSELF***');" >> "$configName"	
	echo "?>" >> "$configName"
	echo "done!"
	echo "[USER ACTION] You gotta set your MySql password in \"$configName\""
fi

indexPhp="index.php"
if [ ! -f "$indexPhp" ]
then
	echo -n "[INFO] Adding default file to be served $indexPhp ... "
	touch index.php
	echo "<!-- generated by jumpStartSource -->" >> $indexPhp
	echo "done!"
fi

# publish - remove error_log from directories containing php files

echo "[INFO] Finished JumpStart. Good luck with the project."

